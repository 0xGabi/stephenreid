<div class="row justify-content-center">
  <div class="col-sm-6">
    <% form_tag '/search', :method => :get do %>
      <div class="input-group input-group-lg">
        <%= search_field_tag :q, :class => 'form-control', :value => params[:q], :placeholder => "Search content I've shared" %>
        <div class="input-group-append">
          <button class="btn btn-outline-secondary" type="submit"><i class="fas fa-search"></i></button>
        </div>
      </div>
      <p class="text-center mb-0">
        <small>
          <strong style="font-weight: 700">Examples</strong>
          <% ['spotify.com', 'youtube.com', 'whatisemerging.com', 'medium.com'].each { |term| %>
            <a class="text-dark" style="text-decoration: none; border-bottom: 1px dotted" href="/search?q=<%=term%>"><%=term%></a>
          <% } %>
          <br />
          <% ['DAO', 'Extinction Rebellion', 'psychedelics'].each { |term| %>
            <a class="text-dark" style="text-decoration: none; border-bottom: 1px dotted" href="/search?q=<%=term%>"><%=term%></a>
          <% } %>            
        </small>
      </p>
    <% end %>
  </div>
</div>


<div class="my-5">
  <p>
    <small>
      <strong style="font-weight: 700">AI-generated tags</strong>
      <% Term.all.map { |term| [term['Name'], term['Posts'] ? term['Posts'].length : 0] }.sort_by { |name,c| -c }.each { |name,c| %>
        <a class="text-dark" style="text-decoration: none; border-bottom: 1px dotted" href="/search?term=<%=name%>"><%=name%></a>
        <span class="badge badge-primary badge-pill"><%=c%></span>
      <% } %>       
    </small>
  </p>

  <p>
    <small>
      <strong style="font-weight: 700">Favourite publishers</strong>
      <% Organisation.all({filter: "{Domain} != ''"}).map { |organisation| [organisation['Name'], organisation['Posts'] ? organisation['Posts'].length : 0] }.sort_by { |name,c| -c }.each { |name,c| %>
        <a class="text-dark" style="text-decoration: none; border-bottom: 1px dotted" href="/search?organisation=<%=name%>"><%=name%></a>
        <span class="badge badge-primary badge-pill"><%=c%></span>
      <% } %> 
    </small>
  </p>
</div>

<div class="row">

  <% if @posts.empty? %>
    <div class="col-12">
      <em>No results</em>
    </div>
  <% else %>
    <%  
    @posts.each { |post|
      json = JSON.parse(post['Iframely'])
      next unless json['links'] && json['links']['thumbnail']
    %>
      <div class="col-sm-4 mb-3">
        <%= partial :post, :locals => {:post => post, :json => json} %>
      </div>
    <% } %>
  <% end %>

</div>